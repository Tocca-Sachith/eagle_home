# 🚀 Eagle Home & Construction - 完全セットアップガイド

## ✅ 実装完了した機能

### 1. 公開ウェブサイト
- ✅ ホームページ（サービス紹介）
- ✅ サービスページ
- ✅ プロジェクトページ
- ✅ プロセスページ
- ✅ お問い合わせフォーム
- ✅ **英語・シンハラ語対応**

### 2. 管理ダッシュボード
- ✅ ダッシュボード
- ✅ 問い合わせ管理
- ✅ **ユーザー管理（完全CRUD）**
- ✅ 顧客管理（プレースホルダー）
- ✅ プロジェクト管理（プレースホルダー）
- ✅ 財務管理（プレースホルダー）
- ✅ レポート（プレースホルダー）

### 3. 認証システム
- ✅ ログイン/ログアウト
- ✅ セッション管理
- ✅ 保護されたルート
- ✅ 役割ベースのアクセス制御

### 4. ユーザー管理
- ✅ ユーザー追加
- ✅ ユーザー編集
- ✅ ユーザー削除
- ✅ パスワード再設定
- ✅ 役割管理（ADMIN / USER）
- ✅ 有効/無効切り替え

---

## 🗄️ データベースセットアップ

### 現在の状態
現在はSQLite（開発用）を使用しています。

### 初回セットアップ
```bash
# 1. 依存関係をインストール
npm install

# 2. Prisma Clientを生成
npx prisma generate

# 3. マイグレーションを実行（既に実行済みの場合はスキップ）
npx prisma migrate dev --name init_with_user

# 4. サンプルデータを投入
npm run db:seed
```

### SEEDデータの内容
- **1人の管理者アカウント** (admin@eaglehome.com / admin123)
- **8件の問い合わせ** （国際的なサンプル）
- **3件の顧客データ**
- **5件のプロジェクト**

---

## 🔐 ログイン方法

### 1. サーバーを起動
```bash
npm run dev
```

### 2. ログインページにアクセス
```
http://localhost:3000/login
```

### 3. デフォルトアカウントでログイン
```
メールアドレス: admin@eaglehome.com
パスワード: admin123
```

### 4. 管理画面にアクセス
ログイン成功後、自動的に `/admin` にリダイレクトされます。

---

## 👥 ユーザー管理

### ユーザー管理ページにアクセス
```
http://localhost:3000/admin/users
```

### 新規ユーザーの追加
1. 「+ 新規ユーザー追加 / Add User」ボタンをクリック
2. 必要情報を入力:
   - **名前**: ユーザーの氏名
   - **メールアドレス**: ログイン用メールアドレス（一意）
   - **パスワード**: 初期パスワード
   - **役割**: USER または ADMIN
3. 「追加 / Add」をクリック

### ユーザー情報の編集
1. ユーザー一覧の「編集」ボタンをクリック
2. 名前、メールアドレス、役割を変更
3. 「更新 / Update」をクリック

### パスワードの再設定
1. ユーザー一覧の「PW」ボタンをクリック
2. 新しいパスワードを入力
3. 「再設定 / Reset」をクリック
4. ユーザーに新しいパスワードを通知

### ユーザーの削除
1. ユーザー一覧の「削除」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

**注意**: 自分自身のアカウントは削除できません

---

## 🌐 多言語機能

### 言語の切り替え
ヘッダー右上の言語ボタンで切り替え:
- **EN** = English（英語）
- **සිං** = Sinhala（シンハラ語）

### 対応ページ
- ✅ ヘッダー・フッター
- ✅ ホームページ
- ✅ お問い合わせフォーム
- ⚠️ その他のページ（翻訳ファイルは準備済み）

### 言語設定の保存
選択した言語はブラウザのlocalStorageに保存され、ページをリロードしても保持されます。

---

## 📊 管理画面の機能

### ダッシュボード (`/admin`)
- 統計情報の表示
- クイックアクション

### 問い合わせ管理 (`/admin/inquiries`)
- 最新20件の問い合わせを表示
- 問い合わせ詳細を確認
- メール・電話で連絡可能

### ユーザー管理 (`/admin/users`)
- ユーザー一覧表示
- ユーザーの追加・編集・削除
- パスワード再設定
- 役割・ステータス管理

---

## 🔒 セキュリティ

### パスワード
- bcryptjsで安全にハッシュ化（10ラウンド）
- プレーンテキストは保存されません

### セッション
- JWT（JSON Web Token）ベース
- 30日間有効
- サーバーサイドで検証

### アクセス制御
- ユーザー管理APIはADMINのみアクセス可能
- 未認証ユーザーは自動的にログインページにリダイレクト

### 環境変数
```env
NEXTAUTH_SECRET="ランダムな長い文字列"  # 本番環境では必ず変更
NEXTAUTH_URL="http://localhost:3000"     # 本番環境ではドメインに変更
```

---

## 🧪 テストシナリオ

### シナリオ1: ログインテスト
```
1. http://localhost:3000/login にアクセス
2. admin@eaglehome.com / admin123 でログイン
3. /admin にリダイレクトされることを確認
4. ヘッダーにユーザー名が表示されることを確認
```

### シナリオ2: 新規ユーザー作成
```
1. /admin/users にアクセス
2. 「+ 新規ユーザー追加」をクリック
3. 情報を入力（例: test@example.com / testuser / password123 / USER）
4. ユーザーが一覧に追加されることを確認
```

### シナリオ3: パスワード再設定
```
1. 作成したユーザーの「PW」ボタンをクリック
2. 新しいパスワード（例: newpassword123）を入力
3. 「再設定」をクリック
4. 一度ログアウトして、新しいパスワードでログイン可能か確認
```

### シナリオ4: ユーザー削除
```
1. 作成したテストユーザーの「削除」ボタンをクリック
2. 確認ダイアログで「OK」
3. ユーザーが一覧から削除されることを確認
```

### シナリオ5: 言語切り替え
```
1. トップページにアクセス
2. 「සිං」ボタンをクリック→シンハラ語表示
3. お問い合わせページにアクセス→シンハラ語のフォーム
4. 「EN」ボタンをクリック→英語表示
```

---

## 📱 利用可能なURL

### 公開ページ
- `http://localhost:3000/` - ホーム
- `http://localhost:3000/services` - サービス
- `http://localhost:3000/projects` - プロジェクト
- `http://localhost:3000/process` - プロセス
- `http://localhost:3000/contact` - お問い合わせ

### 認証
- `http://localhost:3000/login` - ログイン

### 管理画面
- `http://localhost:3000/admin` - ダッシュボード
- `http://localhost:3000/admin/inquiries` - 問い合わせ
- `http://localhost:3000/admin/users` - **ユーザー管理**
- `http://localhost:3000/admin/customers` - 顧客
- `http://localhost:3000/admin/projects` - プロジェクト
- `http://localhost:3000/admin/finance` - 財務
- `http://localhost:3000/admin/reports` - レポート

---

## 💡 よくある質問

### Q: パスワードを忘れた場合は？
A: 現在は別の管理者アカウントでログインして、パスワードを再設定できます。

### Q: 新しい管理者を追加するには？
A: ユーザー管理ページで新規ユーザーを追加する際、役割を「ADMIN」に設定します。

### Q: ユーザーを無効化するには？
A: ユーザー編集画面で「isActive」を false に設定します（将来実装予定）。

### Q: MySQLに切り替えるには？
A: 
1. `.env` の `DATABASE_URL` をMySQLの接続文字列に変更
2. `prisma/schema.prisma` の provider を `"mysql"` に変更
3. `npx prisma migrate dev` を実行

---

## 🎯 本番環境への準備

### 1. 環境変数の設定
```env
DATABASE_URL="mysql://user:pass@host:3306/database"
NEXTAUTH_SECRET="ランダムで長い安全な文字列"
NEXTAUTH_URL="https://your-domain.com"
```

### 2. デフォルトパスワードの変更
```
1. 本番環境にデプロイ後、すぐにログイン
2. /admin/users から admin@eaglehome.com のパスワードを変更
```

### 3. ビルドとデプロイ
```bash
npm run build
npm start
```

または Vercel:
```bash
vercel --prod
```

---

## 📚 関連ドキュメント

- **README.md** - 基本的なセットアップ
- **AUTH_IMPLEMENTATION.md** - 認証システムの詳細
- **I18N_IMPLEMENTATION.md** - 多言語対応の詳細
- **DATABASE_SETUP.md** - データベース設定
- **IMPLEMENTATION_SUMMARY.md** - 全体の実装サマリー

---

## 🎉 すべて準備完了！

認証システムとユーザー管理が完全に実装されました。

### 今すぐ試す:

```bash
# サーバーを起動
npm run dev

# ログイン
http://localhost:3000/login
admin@eaglehome.com / admin123

# ユーザー管理
http://localhost:3000/admin/users
```

---

**質問がある場合は、上記のドキュメントを参照してください！**
